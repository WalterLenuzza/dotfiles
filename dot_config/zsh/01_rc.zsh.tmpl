#!/usr/bin/env zsh

# Shell
if [ -z "$SHELL" ]; then
  export SHELL="$(command -v zsh)"
fi

# Mimic bash `history`
alias history='history -E 1'

# ZSH history settings

# file
# shellcheck disable=SC2154
test -d "$XDG_DATA_HOME"/zsh || mkdir -p "$XDG_DATA_HOME"/zsh
export HISTFILE="$XDG_DATA_HOME"/zsh/history

# Size
export HISTSIZE=1048576
export SAVEHIST=$HISTSIZE

# Add timestamp
# Set imestamps for later analysis. www.debian-administration.org/users/rossen/weblog/1
HISTTIMEFORMAT='%F %T '
# Iignore
HISTIGNORE='&:ls:cd ~:cd ..:pwd:clear:[bf]g:exit:h:history'

#setopt BANG_HIST                 # Treat the '!' character specially during expansion.
setopt EXTENDED_HISTORY          # Write the history file in the ":start:elapsed;command" format.
setopt HIST_EXPIRE_DUPS_FIRST    # Expire duplicate entries first when trimming history.
setopt HIST_IGNORE_DUPS          # Don't record an entry that was just recorded again.
setopt HIST_IGNORE_ALL_DUPS      # Delete old recorded entry if new entry is a duplicate.
setopt HIST_FIND_NO_DUPS         # Do not display a line previously found.
setopt HIST_IGNORE_SPACE         # Don't record an entry starting with a space.
setopt HIST_SAVE_NO_DUPS         # Don't write duplicate entries in the history file.
setopt HIST_REDUCE_BLANKS        # Remove superfluous blanks before recording entry.
setopt HIST_VERIFY               # Don't execute immediately upon history expansion.
setopt HIST_BEEP                 # Beep when accessing nonexistent history.
setopt INC_APPEND_HISTORY        # Write to the history file immediately, not when the shell exits.
setopt SHARE_HISTORY             # Share history between all sessions.

# Mass rename
autoload zmv

# ZSH completion

# enable autocomplete
autoload -Uz compinit
test -d "$XDG_CACHE_HOME"/zsh || mkdir -p "$XDG_CACHE_HOME"/zsh
compinit -d "$XDG_CACHE_HOME"/zsh/zcompdump

setopt autocd nomatch notify
unsetopt beep extendedglob
setopt appendhistory autocd

# Comments
setopt interactivecomments

# arrow-key driven interface
zstyle ':completion:*' menu select

# fuzzy-match
zstyle ':completion:*' completer _complete _match _approximate
zstyle ':completion:*:match:*' original only
zstyle ':completion:*:approximate:*' max-errors 1 numeric

# ignore on missing
zstyle ':completion:*:functions' ignored-patterns '_*'

# autocompletion of privileged environments in privileged commands
zstyle ':completion::complete:*' gain-privileges 1

# autocompletion of command line switches for aliases
setopt COMPLETE_ALIASES

# ZSH prompt

autoload -Uz promptinit
promptinit

prompt suse

# GUI prompt

if [[ -n "$DISPLAY" || -n "$WAYLAND_DISPLAY" || $(uname) == "Darwin" ]]; then
  # Source enhanced prompt for GUI terminal emulators
  if [ -r "$XDG_CONFIG_HOME"/zsh/guiprompt ]; then
    . "$XDG_CONFIG_HOME"/zsh/guiprompt
  fi
fi
